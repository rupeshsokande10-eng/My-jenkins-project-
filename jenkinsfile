pipeline {
    agent any

    stages {

        stage('Clone Repository') {
            steps {
                echo "ğŸ“¥ Fetching code from GitHub..."
                checkout scm
            }
        }

        stage('Install Nginx') {
            steps {
                echo "ğŸ“¦ Installing Nginx (if not installed)..."
                sh '''
                    if ! dpkg -l | grep nginx; then
                      sudo apt-get update -y
                      sudo apt-get install nginx -y
                    else
                      echo "Nginx already installed."
                    fi
                '''
            }
        }

        stage('Deploy Application') {
            steps {
                echo "ğŸš€ Deploying HTML to server..."
                sh '''
                    sudo cp index.html /var/www/html/index.html
                '''
            }
        }

        stage('Restart Nginx') {
            steps {
                echo "ğŸ”„ Restarting Nginx..."
                sh '''
                    sudo systemctl restart nginx
                    sudo systemctl enable nginx
                '''
            }
        }

        stage('Verify Deployment') {
            steps {
                echo "ğŸ” Checking service status..."
                sh 'sudo systemctl status nginx --no-pager'
            }
        }
    }

    post {
        success {
            echo "ğŸ‰ Deployment Successful!"
        }
        failure {
            echo "âŒ Deployment Failed â€” Check logs!"
        }
    }
}
